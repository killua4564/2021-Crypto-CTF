## Linda - medium-hard (unsolved)

* 當時沒時間去想太多，也沒注意到 `p-1` 光滑
* 直接用 `sage` 的 `discrete_log` 就解掉了
```python
# keygen
w = pow(u, x, p)
v = pow(u, r1, p)
pubkey = (p, u, v, w)
privkey = (x, r1)

# encrypt
ca = pow(u, r2, p)
cb = pow(v, s, p) = pow(u, r1 * s, p)
cc = m * pow(w, r2+s, p) = m * pow(u, x * r2, p) * pow(u, x * s, p)

# decrypt
m = cc * pow(ca, -x, p) * pow(cb, x / r1, p) % p  # 這裡的除法是 mod p-1
```
* `discrete_log` 能直接 leak 出 `(x, r1)` 或是 `(s, r2)`
* 所以要反著加密或是順著解密都行
    * 反著加密
    ```python
    Z = Zmod(p) # p-1 smooth
    r = discrete_log(Z(ca), Z(u))
    s = discrete_log(Z(cb), Z(v))
    flag = Z(cc) / (Z(w) ** (r + s))
    ```
    * 順著解密
    ```python
    Z = Zmod(p) # p-1 smooth
    x = discrete_log(Z(w), Z(u))
    r1 = discrete_log(Z(v), Z(u))
    flag = Z(cc) / Z(ca) ** x / Z(cb) ** (x * inverse_mod(r1, p-1))
    ```
* 賽後不知道為什麼我這邊 pwntools 連不上題目，所以手動 nc 拿一份下來當備份
```python
p = 207518404209548066524338597893734179511579167725131843041064866227099212459608943719008703724295244625284967169492023289945294798524212134390763647038291063
u = 4725771409600634767390113924858858311605020034390475368968328268083048943070363681325943149918504474295935205503161695453879697645242271074342095220721811
v = 192592051144695524036406446320257786307445461572986162858397925286285097994481314707381238447094902630926475193331748323319701619067462857212350780878911336
w = 193688812173982903384783472795228738699350038776830885474416093105926497918886438242198467810363655535293264405878081952755755288332354602004706275270687984
ca, cb, cc = (
    202961104920932357964606752012498655594311696320674302329637315490777414597169630039745844900811293021086647866035694564486463566748126095081171550340762637,
    137046396078371748687622651621186941481856833586227643293569497690272738038368101628696368545843890689018630922289456655581435979243550025699757826311940995,
    108321791002545807656680543897570164696297092501068374028277203631090255190244262218544602012187255799471226846663343989851536735289525870107535118074584445
)
```

* `CCTF{1mPr0v3D_CrYp7O_5yST3m_8Y_Boneh_Boyen_Shacham!}`